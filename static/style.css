/* ======== 全局变量与基础设置 ======== */
:root {
    /* Primary Color Palette (Modern Tech Blue - Lighter & Brighter) */
    --hue-primary: 210;
    --saturation-primary: 85%;
    /* Increased saturation for vibrancy */
    --lightness-primary-normal: 58%;
    /* Lighter normal */
    --lightness-primary-darker: 50%;
    /* Lighter darker */
    --lightness-primary-lighter: 96%;
    /* Even lighter for backgrounds */
    --lightness-primary-text-on-dark: 98%;
    --lightness-primary-text-on-light: 8%;

    /* Accent Colors */
    --hue-accent-green: 140;
    /* Slightly bluer green */
    --hue-accent-red: 0;
    --hue-accent-yellow: 45;
    --hue-accent-blue: 205;
    /* Closer to primary */

    /* Neutral Grays - Light Theme (Very Light) */
    --gray-0: #ffffff;
    /* Pure white */
    --gray-50: #fcfdff;
    /* Almost white, slight blue tint */
    --gray-100: #f5f8fa;
    /* Lightest gray */
    --gray-200: #eef2f7;
    /* Soft border */
    --gray-300: #dfe6ef;
    /* Medium border */
    --gray-400: #b0bac9;
    /* Muted text */
    --gray-500: #8693a8;
    /* Secondary text */
    --gray-600: #59677d;
    /* Primary text on light surfaces */
    --gray-700: #3c4a60;
    /* Darker text */
    --gray-800: #253144;
    /* Very dark text */
    --gray-900: #161e2b;
    /* Near black */

    /* Dynamic Color Variables - Light Theme Defaults */
    --primary-color: hsl(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal));
    --primary-hover: hsl(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-darker));
    --primary-light-bg: hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-lighter), 0.7);
    /* Semi-transparent light bg */
    --primary-text-emphasis: hsl(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-darker));

    --bg-page: linear-gradient(135deg, hsl(var(--hue-primary), 60%, 97%) 0%, hsl(var(--hue-accent-blue), 60%, 98%) 100%);
    /* Subtle gradient background */
    --bg-surface: hsla(0, 0%, 100%, 0.65);
    /* Reduced opacity for stronger glass */
    --bg-surface-alt: hsla(var(--hue-primary), 30%, 97%, 0.7);
    --bg-input: hsla(0, 0%, 100%, 0.8);

    --text-primary: var(--gray-700);
    --text-secondary: var(--gray-500);
    --text-muted: var(--gray-400);
    --text-on-primary-bg: var(--lightness-primary-text-on-dark);

    --border-color-soft: hsla(var(--hue-primary), 30%, 85%, 0.4);
    /* Even softer borders */
    --border-color-medium: hsla(var(--hue-primary), 30%, 75%, 0.5);
    --border-color-strong: hsla(var(--hue-primary), 30%, 65%, 0.6);

    --user-msg-bg: var(--primary-color);
    --user-msg-text: var(--text-on-primary-bg);
    --user-msg-icon-color: hsla(0, 0%, 100%, 0.9);
    --agent-msg-bg: hsla(var(--hue-primary), 40%, 95%, 0.8);
    /* Lighter agent bubble */
    --agent-msg-text: var(--text-primary);
    --agent-msg-icon-color: var(--text-muted);

    /* Agent message thought prefix (bubble inside bubble) */
    --agent-msg-thought-bg: hsla(var(--hue-primary), var(--saturation-primary), 94%, 0.85);
    /* Distinct background for thought */
    --agent-msg-thought-text: hsl(var(--hue-primary), var(--saturation-primary), 35%);
    /* Text color for thought */
    --agent-msg-thought-border: hsla(var(--hue-primary), var(--saturation-primary), 80%, 0.7);
    /* Border for thought */

    --system-msg-bg: hsla(var(--hue-primary), 25%, 97%, 0.85);
    --system-msg-border: hsla(var(--hue-primary), 25%, 88%, 0.65);
    --system-msg-text: hsl(var(--hue-primary), 25%, 40%);
    --log-bg: hsla(var(--hue-primary), 20%, 98%, 0.7);
    --log-text: var(--gray-600);
    --log-think-bg: hsla(var(--hue-primary), var(--saturation-primary), 96%, 0.8);
    --log-think-text: hsl(var(--hue-primary), var(--saturation-primary), 35%);
    --log-border: hsla(var(--hue-primary), 25%, 88%, 0.55);
    --log-item-tool-plan-bg: hsla(var(--hue-primary), 20%, 97%, 0.75);

    --success-color: hsl(var(--hue-accent-green), 60%, 45%);
    --error-color: hsl(var(--hue-accent-red), 70%, 50%);
    --warning-color: hsl(var(--hue-accent-yellow), 80%, 50%);
    --info-color: hsl(var(--hue-accent-blue), 80%, 60%);

    --success-bg-light: hsla(var(--hue-accent-green), 75%, 96%, 0.8);
    --error-bg-light: hsla(var(--hue-accent-red), 75%, 97%, 0.8);
    --warning-bg-light: hsla(var(--hue-accent-yellow), 85%, 96%, 0.8);
    --info-bg-light: hsla(var(--hue-accent-blue), 75%, 96%, 0.8);

    /* Shadows - Softer and more diffused for light theme */
    --shadow-xs: 0 1px 2px hsla(var(--hue-primary), 20%, 50%, 0.08);
    --shadow-sm: 0 2px 5px hsla(var(--hue-primary), 20%, 50%, 0.1);
    --shadow-md: 0 4px 10px hsla(var(--hue-primary), 20%, 50%, 0.12);
    --shadow-lg: 0 8px 18px hsla(var(--hue-primary), 20%, 50%, 0.14);
    --shadow-xl: 0 15px 30px hsla(var(--hue-primary), 20%, 50%, 0.16);
    --shadow-inset: inset 0 1px 3px hsla(var(--hue-primary), 20%, 50%, 0.06);

    /* Transitions - Smoother cubic beziers */
    --transition-duration-short: 0.2s;
    --transition-duration-medium: 0.3s;
    --transition-duration-long: 0.45s;
    --transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    /* Standard smooth */
    --transition-timing-function-smooth: cubic-bezier(0.645, 0.045, 0.355, 1);
    /* Smoother ease-in-out */
    --transition-default: all var(--transition-duration-medium) var(--transition-timing-function-smooth);


    /* Borders & Radii */
    --border-radius-sm: 6px;
    /* Slightly more rounded */
    --border-radius-md: 10px;
    --border-radius-lg: 14px;
    --border-radius-xl: 18px;
    --border-radius-round: 50%;
    --border-radius-pill: 999px;

    /* Sizing & Spacing */
    --spacing-unit: 8px;
    --header-height: 64px;
    /* Slightly taller header */
    --sidebar-width-expanded: 270px;
    /* Wider sidebar */
    --sidebar-width-collapsed: 76px;
    --input-area-min-height: 52px;
    --input-area-max-height: 220px;
    --textarea-padding-vertical: calc(var(--spacing-unit) * 1.5);

    --backdrop-blur-amount: 10px;
    /* Slightly reduced main blur for performance and subtlety */
}

/* Dark Theme Variables */
.dark-theme {
    --hue-primary: 210;
    --saturation-primary: 70%;
    --lightness-primary-normal: 60%;
    /* Brighter for dark mode */
    --lightness-primary-darker: 52%;
    --lightness-primary-lighter: 25%;
    /* Darker light bg */
    --lightness-primary-text-on-dark: 98%;
    --lightness-primary-text-on-light: 10%;

    /* Neutral Grays - Dark Theme */
    --gray-0: #0e1015;
    /* Darker base */
    --gray-50: #14181e;
    /* Surface */
    --gray-100: #1c2128;
    /* Surface alt */
    --gray-200: #2a303a;
    /* Borders */
    --gray-300: #3b424e;
    --gray-400: #555e6d;
    --gray-500: #7d8796;
    --gray-600: #a7b0bd;
    --gray-700: #ced5de;
    --gray-800: #e4e8ec;
    --gray-900: #f3f5f7;

    --primary-color: hsl(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal));
    --primary-hover: hsl(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-darker));
    --primary-light-bg: hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-lighter), 0.65);
    --primary-text-emphasis: hsl(var(--hue-primary), var(--saturation-primary), 80%);

    --bg-page: linear-gradient(135deg, hsl(var(--hue-primary), 20%, 8%) 0%, hsl(var(--hue-accent-blue), 25%, 10%) 100%);
    --bg-surface: hsla(var(--hue-primary), 15%, 10%, 0.7);
    /* Darker glass */
    --bg-surface-alt: hsla(var(--hue-primary), 15%, 13%, 0.75);
    --bg-input: hsla(var(--hue-primary), 15%, 16%, 0.8);

    --text-primary: var(--gray-800);
    --text-secondary: var(--gray-600);
    --text-muted: var(--gray-500);
    --text-on-primary-bg: var(--lightness-primary-text-on-dark);

    --border-color-soft: hsla(var(--hue-primary), 15%, 22%, 0.45);
    --border-color-medium: hsla(var(--hue-primary), 15%, 32%, 0.55);
    --border-color-strong: hsla(var(--hue-primary), 15%, 42%, 0.65);

    --user-msg-bg: var(--primary-color);
    --user-msg-text: var(--text-on-primary-bg);
    --user-msg-icon-color: hsla(210, 20%, 90%, 0.9);
    --agent-msg-bg: hsla(var(--hue-primary), 20%, 18%, 0.8);
    --agent-msg-text: var(--text-primary);
    --agent-msg-icon-color: var(--text-muted);

    /* Agent message thought prefix (bubble inside bubble) - Dark Theme */
    --agent-msg-thought-bg: hsla(var(--hue-primary), var(--saturation-primary), 15%, 0.85);
    --agent-msg-thought-text: hsl(var(--hue-primary), var(--saturation-primary), 75%);
    --agent-msg-thought-border: hsla(var(--hue-primary), var(--saturation-primary), 25%, 0.7);

    --system-msg-bg: hsla(var(--hue-primary), 20%, 16%, 0.88);
    --system-msg-border: hsla(var(--hue-primary), 20%, 26%, 0.68);
    --system-msg-text: hsl(var(--hue-primary), 20%, 78%);
    --log-bg: hsla(var(--hue-primary), 18%, 12%, 0.7);
    --log-text: var(--gray-700);
    --log-think-bg: hsla(var(--hue-primary), var(--saturation-primary), 20%, 0.8);
    --log-think-text: hsl(var(--hue-primary), var(--saturation-primary), 75%);
    --log-border: hsla(var(--hue-primary), 15%, 28%, 0.58);
    --log-item-tool-plan-bg: hsla(var(--hue-primary), 20%, 16%, 0.78);

    --success-color: hsl(var(--hue-accent-green), 50%, 55%);
    --error-color: hsl(var(--hue-accent-red), 60%, 60%);
    --warning-color: hsl(var(--hue-accent-yellow), 70%, 60%);
    --info-color: hsl(var(--hue-accent-blue), 70%, 65%);

    --success-bg-light: hsla(var(--hue-accent-green), 55%, 23%, 0.8);
    --error-bg-light: hsla(var(--hue-accent-red), 55%, 23%, 0.8);
    --warning-bg-light: hsla(var(--hue-accent-yellow), 55%, 23%, 0.8);
    --info-bg-light: hsla(var(--hue-accent-blue), 55%, 23%, 0.8);

    --shadow-xs: 0 1px 2px hsla(0, 0%, 0%, 0.3);
    --shadow-sm: 0 2px 5px hsla(0, 0%, 0%, 0.35);
    --shadow-md: 0 4px 10px hsla(0, 0%, 0%, 0.4);
    --shadow-lg: 0 8px 18px hsla(0, 0%, 0%, 0.4);
    --shadow-xl: 0 15px 30px hsla(0, 0%, 0%, 0.45);
    --shadow-inset: inset 0 1px 3px hsla(0, 0%, 0%, 0.25);
}

/* Frosted Glass Helper Class */
.glass-effect {
    -webkit-backdrop-filter: blur(var(--backdrop-blur-amount));
    backdrop-filter: blur(var(--backdrop-blur-amount));
}

.page-background-gradient {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-page);
    z-index: -1;
}

/* FontAwesome Spin Pulse */
.fa-spin-pulse {
    animation: fa-spin-pulse var(--fa-animation-duration, 2s) var(--fa-animation-iteration-count, infinite) var(--fa-animation-timing, linear);
}

@keyframes fa-spin-pulse {

    0%,
    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }

    25% {
        transform: scale(1.1) rotate(90deg);
        opacity: 0.75;
    }

    50% {
        transform: scale(1) rotate(180deg);
        opacity: 1;
    }

    75% {
        transform: scale(0.9) rotate(270deg);
        opacity: 0.75;
    }
}

/* Base Styles */
*,
*::before,
*::after {
    box-sizing: border-box;
}

html {
    font-size: 16px;
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body {
    font-family: 'Roboto', 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    margin: 0;
    background-color: transparent;
    /* Page background is handled by .page-background-gradient */
    color: var(--text-primary);
    transition: color var(--transition-duration-medium), font-size var(--transition-duration-short);
    overflow: hidden;
    /* Prevent body scroll */
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: hsla(0, 0%, 0%, 0.05);
    border-radius: var(--border-radius-pill);
}

::-webkit-scrollbar-thumb {
    background-color: var(--border-color-medium);
    border-radius: var(--border-radius-pill);
    border: 2px solid transparent;
    background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
    background-color: var(--text-muted);
}

/* Buttons */
button,
.btn {
    cursor: pointer;
    font-family: inherit;
    border: none;
    outline: none;
    background: none;
    padding: calc(var(--spacing-unit) * 1.25) calc(var(--spacing-unit) * 2);
    border-radius: var(--border-radius-md);
    transition: var(--transition-default);
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-unit);
    text-decoration: none;
    line-height: 1.4;
    white-space: nowrap;
}

button:disabled,
.btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    box-shadow: none !important;
    transform: none !important;
}

button:focus-visible,
.btn:focus-visible {
    outline: 2px solid var(--primary-hover);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.25);
}

.icon-btn {
    padding: var(--spacing-unit);
    width: calc(var(--spacing-unit) * 4.75);
    height: calc(var(--spacing-unit) * 4.75);
    font-size: 1.15rem;
    color: var(--text-secondary);
}

.icon-btn:hover {
    background-color: hsla(var(--hue-primary), var(--saturation-primary), 50%, 0.1);
    color: var(--primary-color);
}

.primary-btn {
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    box-shadow: var(--shadow-sm), 0 0 0 1px hsla(0, 0%, 100%, 0.1) inset;
}

.primary-btn:hover {
    background-color: var(--primary-hover);
    box-shadow: var(--shadow-md), 0 0 0 1px hsla(0, 0%, 100%, 0.15) inset;
    transform: translateY(-2px);
}

.primary-btn:active {
    transform: translateY(-1px);
    box-shadow: var(--shadow-xs);
}

.secondary-btn {
    background-color: var(--bg-surface);
    color: var(--text-primary);
    border: 1px solid var(--border-color-medium);
    box-shadow: var(--shadow-xs);
}

.secondary-btn:hover {
    background-color: var(--bg-surface-alt);
    border-color: var(--border-color-strong);
    box-shadow: var(--shadow-sm);
}

/* Loader */
.loader-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: hsla(var(--hue-primary), 50%, 98%, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    transition: opacity var(--transition-duration-long) var(--transition-timing-function-smooth), visibility var(--transition-duration-long) var(--transition-timing-function-smooth);
    visibility: visible;
    opacity: 1;
}

.dark-theme .loader-container {
    background-color: hsla(var(--hue-primary), 15%, 10%, 0.9);
}

.loader-container.hidden {
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
}

.loader-logo {
    display: flex;
    align-items: center;
    font-size: 2.4rem;
    color: var(--primary-color);
    margin-bottom: calc(var(--spacing-unit) * 2);
}

.loader-logo .fa-microchip {
    font-size: 3rem;
    margin-right: calc(var(--spacing-unit) * 1.25);
}

.loader-logo span {
    font-weight: 600;
    letter-spacing: 0.5px;
}

.loader-progress-bar {
    width: 240px;
    height: 8px;
    background-color: var(--border-color-soft);
    border-radius: var(--border-radius-pill);
    overflow: hidden;
    margin-bottom: calc(var(--spacing-unit) * 3);
    box-shadow: var(--shadow-inset);
}

.loader-progress {
    width: 0%;
    height: 100%;
    background-color: var(--primary-color);
    border-radius: var(--border-radius-pill);
    transition: width 0.6s var(--transition-timing-function-smooth);
}

.loading-text {
    font-size: 1rem;
    color: var(--text-secondary);
    animation: pulseText 2s infinite var(--transition-timing-function-smooth);
}

@keyframes pulseText {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.65;
        transform: scale(1.02);
    }
}

/* Main Layout */
.main-container {
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
    opacity: 0;
    transition: opacity var(--transition-duration-long) var(--transition-timing-function-smooth);
}

.main-container.loaded {
    opacity: 1;
}

.header {
    height: var(--header-height);
    box-shadow: var(--shadow-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 calc(var(--spacing-unit) * 3.5);
    transition: background-color var(--transition-duration-medium);
    z-index: 100;
    position: relative;
}

.header.glass-effect {
    background-color: var(--bg-surface);
    border-bottom: 1px solid var(--border-color-soft);
}


.logo {
    display: flex;
    align-items: center;
}

.logo-icon {
    font-size: 1.8rem;
    color: var(--primary-color);
    margin-right: calc(var(--spacing-unit) * 1.5);
}

.logo h1 {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    letter-spacing: 0.3px;
}

.version-pro {
    font-size: 0.75rem;
    color: var(--primary-color);
    font-weight: bold;
    margin-left: 0.5rem;
    background-color: var(--primary-light-bg);
    padding: 4px 8px;
    border-radius: var(--border-radius-md);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-xs);
}

.version-pro .version-number {
    font-size: 0.9em;
    opacity: 0.85;
}

.dark-theme .version-pro {
    color: hsl(var(--hue-primary), var(--saturation-primary), 85%);
    background-color: hsla(var(--hue-primary), var(--saturation-primary), 30%, 0.8);
}

.header-buttons {
    display: flex;
    gap: calc(var(--spacing-unit) * 1);
}

.header-btn {
    width: 42px;
    height: 42px;
    border-radius: var(--border-radius-round);
    font-size: 1.1rem;
    color: var(--text-secondary);
    background-color: transparent;
}

.header-btn:hover {
    background-color: hsla(var(--hue-primary), var(--saturation-primary), 50%, 0.08);
    color: var(--primary-color);
}

.header-btn:active {
    transform: scale(0.92);
}

.chat-container {
    flex: 1;
    display: flex;
    overflow: hidden;
    position: relative;
}

.sidebar {
    width: var(--sidebar-width-collapsed);
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
    padding: calc(var(--spacing-unit) * 2) 0;
    transition: width var(--transition-duration-long) var(--transition-timing-function-smooth), background-color var(--transition-duration-medium);
    z-index: 50;
    flex-shrink: 0;
    position: relative;
}

.sidebar.glass-effect {
    background-color: var(--bg-surface);
    border-right: 1px solid var(--border-color-soft);
}

.sidebar.expanded {
    width: var(--sidebar-width-expanded);
}

.sidebar-content-wrapper {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    padding: 0 calc(var(--spacing-unit) * 0.5);
}


.sidebar-main-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: calc(var(--spacing-unit) * 1);
    margin-bottom: calc(var(--spacing-unit) * 2.5);
    padding: 0 calc(var(--spacing-unit) * 1.5);
}

.sidebar-button {
    width: 100%;
    height: 52px;
    border-radius: var(--border-radius-lg);
    flex-direction: row;
    justify-content: flex-start;
    padding: 0 calc(var(--spacing-unit) * 1.75);
    color: var(--text-secondary);
    position: relative;
    overflow: hidden;
}

.sidebar:not(.expanded) .sidebar-button {
    flex-direction: column;
    height: 60px;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.sidebar-button i {
    font-size: 1.35rem;
    min-width: 28px;
    text-align: center;
    transition: transform var(--transition-duration-medium) var(--transition-timing-function-smooth);
}

.sidebar:not(.expanded) .sidebar-button i {
    margin-bottom: 5px;
    font-size: 1.5rem;
}

.sidebar-button span {
    font-size: 0.9rem;
    line-height: 1.2;
    opacity: 0;
    transform: translateX(-15px);
    transition: opacity var(--transition-duration-medium) var(--transition-timing-function-smooth), transform var(--transition-duration-medium) var(--transition-timing-function-smooth);
    margin-left: calc(var(--spacing-unit) * 1.25);
    font-weight: 500;
}

.sidebar.expanded .sidebar-button span {
    opacity: 1;
    transform: translateX(0);
}

.sidebar:not(.expanded) .sidebar-button span {
    display: none;
}

.sidebar-button:hover {
    background-color: var(--primary-light-bg);
    color: var(--primary-text-emphasis);
    transform: scale(1.02);
}

.sidebar-button.active {
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    box-shadow: 0 3px 10px hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.35);
}

.sidebar-button.active:hover {
    background-color: var(--primary-hover);
}

.session-manager {
    border-top: 1px solid var(--border-color-soft);
    margin-top: auto;
    padding-bottom: calc(var(--spacing-unit) * 1.5);
}

.session-manager-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: calc(var(--spacing-unit) * 1.75) calc(var(--spacing-unit) * 2);
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 0.95rem;
    opacity: 0;
    transform: translateX(-20px);
    transition: opacity var(--transition-duration-medium) 0.1s var(--transition-timing-function-smooth), transform var(--transition-duration-medium) 0.1s var(--transition-timing-function-smooth);
    font-weight: 500;
}

.sidebar.expanded .session-manager-header {
    opacity: 1;
    transform: translateX(0);
}

.sidebar:not(.expanded) .session-manager-header {
    display: none;
}

.session-manager-header:hover {
    color: var(--primary-text-emphasis);
}

.session-manager-header .toggle-icon {
    transition: transform var(--transition-duration-medium) var(--transition-timing-function-smooth);
}

.session-manager.collapsed .toggle-icon {
    transform: rotate(-90deg);
}

.session-list-container {
    max-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
    transition: max-height var(--transition-duration-long) var(--transition-timing-function-smooth),
        padding var(--transition-duration-long) var(--transition-timing-function-smooth);
}

.session-manager:not(.collapsed) .session-list-container {
    max-height: 280px;
    padding: 0 calc(var(--spacing-unit) * 2) calc(var(--spacing-unit) * 2);
}

.session-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.session-list-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: calc(var(--spacing-unit) * 1.25) var(--spacing-unit);
    margin-bottom: calc(var(--spacing-unit) * 1);
    border-radius: var(--border-radius-lg);
    cursor: pointer;
    font-size: 0.875rem;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: background-color var(--transition-duration-short), color var(--transition-duration-short), transform var(--transition-duration-short) var(--transition-timing-function-smooth);
    position: relative;
}

.session-list-item:hover {
    background-color: var(--bg-surface-alt);
    color: var(--primary-text-emphasis);
    transform: translateX(3px);
}

.session-list-item.active-session {
    background-color: var(--primary-light-bg);
    color: var(--primary-text-emphasis);
    font-weight: 600;
    box-shadow: var(--shadow-sm);
}

.session-list-item .session-item-content {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    overflow: hidden;
}

.session-list-item .session-name {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
    margin-bottom: 3px;
}

.session-list-item .session-time {
    font-size: 0.78rem;
    color: var(--text-muted);
}

.session-delete-btn {
    font-size: 0.85rem;
    color: var(--text-muted);
    opacity: 0;
    transition: opacity var(--transition-duration-short) var(--transition-timing-function-smooth);
    padding: calc(var(--spacing-unit)*0.6);
    align-self: center;
}

.session-list-item:hover .session-delete-btn {
    opacity: 1;
}

.session-delete-btn:hover {
    color: var(--error-color);
}

.session-list-empty {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.9rem;
    padding: calc(var(--spacing-unit) * 1.5) 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-unit);
}

.session-list-empty i {
    font-size: 1.5rem;
    opacity: 0.7;
}

#create-new-session {
    width: calc(100% - var(--spacing-unit) * 4);
    margin: calc(var(--spacing-unit) * 2) auto 0;
    display: flex;
    background-color: var(--primary-light-bg);
    color: var(--primary-text-emphasis);
    font-size: 0.95rem;
    font-weight: 500;
    box-shadow: var(--shadow-xs);
}

.sidebar:not(.expanded) #create-new-session {
    width: 52px;
    height: 52px;
    border-radius: var(--border-radius-round);
    margin: calc(var(--spacing-unit) * 1.5) auto;
    font-size: 1.4rem;
}

.sidebar:not(.expanded) #create-new-session span {
    display: none;
}

.sidebar.expanded #create-new-session .fa-plus-circle {
    margin-right: calc(var(--spacing-unit) * 1.25);
}

#create-new-session:hover {
    background-color: hsl(var(--hue-primary), var(--saturation-primary), 90%);
    box-shadow: var(--shadow-sm);
}

.dark-theme #create-new-session:hover {
    background-color: hsl(var(--hue-primary), var(--saturation-primary), 28%);
}


.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0;
    background-color: hsla(0, 0%, 100%, 0.1);
    /* Slight tint if page background isn't fully covering */
    position: relative;
}

.chat-area-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    margin: 0;
    /* No margin for chat area content itself */
}

.chat-area-content.glass-effect {
    background-color: hsla(var(--hue-primary), 50%, 98%, 0.6);
    /* border-left: 1px solid hsla(var(--hue-primary), 50%, 90%, 0.2); */
    /* border-top: 1px solid hsla(var(--hue-primary), 50%, 90%, 0.2); */
}

.dark-theme .chat-area-content.glass-effect {
    background-color: hsla(var(--hue-primary), 20%, 10%, 0.65);
    /* border-left: 1px solid hsla(var(--hue-primary), 20%, 15%, 0.3); */
    /* border-top: 1px solid hsla(var(--hue-primary), 20%, 15%, 0.3); */
}


.chat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 calc(var(--spacing-unit)*3);
    height: calc(var(--header-height) - 14px);
    /* Slightly smaller than main header */
    background-color: transparent;
    /* Let glass effect show through */
    border-bottom: 1px solid var(--border-color-soft);
    flex-shrink: 0;
    /* Prevent shrinking */
}

#current-session-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

#edit-session-name-btn {
    font-size: 0.95rem;
}

.process-log-container {
    border-bottom: 1px solid var(--border-color-soft);
    padding: calc(var(--spacing-unit)*1.5) calc(var(--spacing-unit)*3);
    font-size: 0.875rem;
    transition: max-height var(--transition-duration-long) var(--transition-timing-function-smooth),
        padding var(--transition-duration-long) var(--transition-timing-function-smooth),
        opacity var(--transition-duration-long) var(--transition-timing-function-smooth);
    max-height: 220px;
    /* Max height when expanded */
    overflow-y: auto;
    flex-shrink: 0;
    position: relative;
}

.process-log-container.glass-effect {
    background-color: var(--log-bg);
    border-bottom: 1px solid var(--border-color-soft);
    /* Keep border for definition */
}


.process-log-container.collapsed {
    max-height: calc(var(--spacing-unit)*4 + 2px + var(--spacing-unit)*1.5*2 - var(--spacing-unit)*1.5);
    /* Height of header */
    padding-top: calc(var(--spacing-unit)*1);
    padding-bottom: calc(var(--spacing-unit)*1);
    overflow: hidden;
}

.process-log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--text-secondary);
    font-weight: 500;
    cursor: pointer;
    height: calc(var(--spacing-unit)*3);
    /* Consistent height for header */
    margin-bottom: var(--spacing-unit);
}

.process-log-header span {
    display: flex;
    align-items: center;
    gap: calc(var(--spacing-unit)*1.25);
}

.process-log-header .icon-btn {
    font-size: 1rem;
    padding: calc(var(--spacing-unit)*0.6);
    color: var(--text-muted);
}

.process-log-header .icon-btn:hover {
    color: var(--text-secondary);
}

#toggle-process-log-collapse i {
    transition: transform var(--transition-duration-medium) var(--transition-timing-function-smooth);
}

.process-log-content {
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit)*1);
}

.log-item {
    display: flex;
    align-items: flex-start;
    gap: calc(var(--spacing-unit)*1.25);
    word-break: break-word;
    line-height: 1.55;
    color: var(--log-text);
    padding: calc(var(--spacing-unit)*0.75) var(--spacing-unit);
    border-radius: var(--border-radius-md);
    transition: background-color 0.25s var(--transition-timing-function-smooth);
    border: 1px solid transparent;
    /* Base border */
}

.log-item.type-tool_status_update {
    border-left-width: 4px;
    /* Thicker left border for tool updates */
    padding-left: calc(var(--spacing-unit) * 1.5);
}

.log-item.type-tool_status_update.status-running {
    border-left-color: var(--info-color);
    background-color: hsla(var(--hue-accent-blue), 75%, 96%, 0.5);
}

.dark-theme .log-item.type-tool_status_update.status-running {
    background-color: hsla(var(--hue-accent-blue), 55%, 25%, 0.5);
}

.log-item.type-tool_status_update.status-succeeded {
    border-left-color: var(--success-color);
}

.log-item.type-tool_status_update.status-failed,
.log-item.type-tool_status_update.status-aborted {
    border-left-color: var(--error-color);
}


.log-item:hover {
    background-color: hsla(var(--hue-primary), 20%, 94%, 0.7);
}

.dark-theme .log-item:hover {
    background-color: hsla(var(--hue-primary), 15%, 18%, 0.7);
}

.log-item>i {
    /* Icon styling */
    margin-top: 4px;
    flex-shrink: 0;
    width: 20px;
    /* Ensure icons align */
    text-align: center;
    font-size: 0.95em;
}

.log-item-text-wrapper {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.log-item-message {
    font-weight: 400;
}

.log-item-details {
    font-size: 0.9em;
    color: var(--text-muted);
    margin-top: calc(var(--spacing-unit) * 0.75);
    padding-left: calc(var(--spacing-unit) * 1.25);
    border-left: 2px solid var(--border-color-soft);
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 0.4);
}

.log-detail-item {
    display: flex;
    gap: calc(var(--spacing-unit) * 0.75);
    line-height: 1.45;
}

.log-detail-item strong {
    font-weight: 500;
    color: var(--text-secondary);
    flex-shrink: 0;
}

.log-detail-item span {
    word-break: break-all;
}

.log-detail-preview-code {
    background-color: hsla(0, 0%, 0%, 0.03);
    padding: var(--spacing-unit) * 0.5;
    border-radius: var(--border-radius-sm);
    font-family: monospace;
    font-size: 0.9em;
    max-height: 100px;
    overflow: auto;
}

.dark-theme .log-detail-preview-code {
    background-color: hsla(0, 0%, 100%, 0.05);
}


.log-item.status-started .log-item-message,
.log-item .log-info {
    /* For icons with log-info class */
    color: var(--info-color);
}

.log-item.status-completed .log-item-message,
.log-item.status-succeeded .log-item-message,
.log-item .log-success {
    /* For icons with log-success class */
    color: var(--success-color);
}

.log-item.status-error .log-item-message,
.log-item.status-failed .log-item-message,
.log-item .log-error {
    /* For icons with log-error class */
    color: var(--error-color);
}

.log-item.status-warning .log-item-message,
/* Added for consistency */
.log-item .log-warning {
    /* For icons with log-warning class */
    color: var(--warning-color);
}

.log-item.status-ignored .log-item-message,
.log-item.status-aborted .log-item-message,
.log-item .log-muted {
    /* For icons with log-muted class */
    color: var(--text-muted);
    font-style: italic;
}


.log-item.stage-planning .log-item-message {
    /* Emphasize planning stage messages */
    font-weight: 500;
}

.log-item.type-tool_status_update .log-item-message {
    /* Specific font for tool messages */
    font-family: 'Roboto Mono', monospace;
    font-size: 0.92em;
}

.log-item.type-tool_status_update .log-item-details {
    font-family: 'Roboto Mono', monospace;
}

.log-item.type-thinking_log .log-item-message {
    /* Thinking log summary in process log */
    font-style: italic;
    color: var(--primary-text-emphasis);
}

.log-think-content {
    font-size: 0.9em;
    background-color: var(--log-think-bg);
    color: var(--log-think-text);
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.75);
    border-radius: var(--border-radius-lg);
    margin-top: calc(var(--spacing-unit) * 1);
    border: 1px solid var(--log-border);
    border-left: 5px solid var(--primary-color);
    font-style: normal;
    /* Override italic if parent is italic */
    opacity: 0.98;
    white-space: pre-wrap;
    /* Allow line breaks from think content */
    word-break: break-word;
    box-shadow: var(--shadow-sm);
}

.dark-theme .log-think-content {
    border-left-color: var(--primary-hover);
    border-color: var(--border-color-medium);
}

.log-think-content strong {
    /* Label like "Detailed Thought Process:" */
    display: block;
    font-weight: 600;
    margin-bottom: calc(var(--spacing-unit) * 0.75);
    color: var(--primary-text-emphasis);
}

.dark-theme .log-think-content strong {
    color: hsl(var(--hue-primary), var(--saturation-primary), 70%);
}

.log-think-content .think-bubble {
    /* The actual thought text */
    padding-top: calc(var(--spacing-unit) * 0.5);
}


.chat-box {
    flex: 1;
    overflow-y: auto;
    padding: calc(var(--spacing-unit) * 3);
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 0.75);
    /* Reduced gap slightly */
}

.message {
    max-width: 80%;
    line-height: 1.65;
    word-break: break-word;
    transition: var(--transition-default);
    position: relative;
    display: flex;
    gap: calc(var(--spacing-unit) * 1.25);
    margin-bottom: calc(var(--spacing-unit) * 1.75);
    /* Consistent bottom margin */
}

.message-avatar {
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-round);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    flex-shrink: 0;
    margin-top: calc(var(--spacing-unit)*0.5);
    /* Align with first line of text better */
    box-shadow: var(--shadow-sm);
}

.message-user .message-avatar {
    background-color: var(--user-msg-bg);
    color: var(--user-msg-icon-color);
    order: 1;
    /* Avatar on the right for user */
}

.message-agent .message-avatar {
    background-color: var(--agent-msg-bg);
    color: var(--agent-msg-icon-color);
    border: 1px solid var(--border-color-soft);
}

.dark-theme .message-agent .message-avatar {
    background-color: var(--gray-200);
    /* Darker avatar bg for agent in dark theme */
}


.message-bubble {
    padding: calc(var(--spacing-unit)*1.5) calc(var(--spacing-unit)*2);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-md);
    flex-grow: 1;
    /* Allow bubble to take available space */
    transition: transform 0.2s var(--transition-timing-function-smooth), box-shadow 0.2s var(--transition-timing-function-smooth);
}


.message-user {
    align-self: flex-end;
    flex-direction: row-reverse;
    /* Avatar on the right */
}

.message-user .message-bubble {
    background-color: var(--user-msg-bg);
    color: var(--user-msg-text);
    border-bottom-right-radius: var(--border-radius-sm);
    /* User bubble tail */
}

.message-agent {
    align-self: flex-start;
}

.message-agent .message-bubble {
    background-color: var(--agent-msg-bg);
    color: var(--agent-msg-text);
    border-bottom-left-radius: var(--border-radius-sm);
    /* Agent bubble tail */
}

.dark-theme .message-agent .message-bubble {
    background-color: var(--gray-100);
    /* Different agent bubble for dark theme */
}

.message:hover .message-bubble {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px) scale(1.005);
}

.message-content-wrapper {
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 0.5);
    /* Gap between thought and text, or text and attachments */
    padding: calc(var(--spacing-unit) * 0.5) 0;
    /* Internal padding if needed, usually not */
    width: 100%;
}

.message-thought-prefix {
    display: block;
    font-size: 0.85em;
    font-style: italic;
    color: var(--agent-msg-thought-text);
    background-color: var(--agent-msg-thought-bg);
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.5);
    margin: calc(var(--spacing-unit)*-1)
        /* Adjust top margin to be slightly less than bubble padding */
        calc(var(--spacing-unit)*-1.5)
        /* Adjust side margins */
        calc(var(--spacing-unit)*1.25)
        /* Bottom margin to separate from main content */
        calc(var(--spacing-unit)*-1.5);
    /* Adjust side margins */

    border-bottom: 1px solid var(--agent-msg-thought-border);
    border-top-left-radius: var(--border-radius-xl);
    border-top-right-radius: var(--border-radius-xl);

    white-space: pre-wrap;
    word-break: break-word;
    max-height: 200px;
    overflow-y: auto;
    box-shadow: var(--shadow-inset);
}

.dark-theme .message-thought-prefix {
    color: var(--agent-msg-thought-text);
    background-color: var(--agent-msg-thought-bg);
    border-bottom-color: var(--agent-msg-thought-border);
}

.message-thought-prefix strong {
    display: block;
    font-weight: 600;
    font-style: normal;
    margin-bottom: calc(var(--spacing-unit) * 0.75);
    color: var(--primary-text-emphasis);
}

.dark-theme .message-thought-prefix strong {
    color: hsl(var(--hue-primary), var(--saturation-primary), 75%);
}

.message-thought-prefix .think-bubble-content {
    padding-top: calc(var(--spacing-unit) * 0.25);
    font-style: normal;
    line-height: 1.45;
}

.message-text-content {
    /* No specific top padding here, as the gap from message-content-wrapper handles it */
    font-size: 0.95em;
    /* Default font size */
}

.message-thought-prefix+.message-text-content {
    /* If text-content directly follows thought-prefix, no extra top padding from here */
    /* The gap is managed by message-content-wrapper or thought-prefix's bottom margin */
    padding-top: 0;
    /* No extra padding */
}

.message-text-content a {
    color: var(--primary-hover);
    text-decoration: underline;
    text-decoration-thickness: 1.5px;
    text-underline-offset: 3px;
}

.message-text-content a:hover {
    color: var(--primary-color);
    text-decoration-thickness: 2px;
}

.message.system-message {
    align-self: center;
    width: 100%;
    max-width: 720px;
    background-color: var(--system-msg-bg);
    color: var(--system-msg-text);
    border: 1px solid var(--system-msg-border);
    border-left-width: 6px;
    border-left-color: var(--primary-color);
    box-shadow: var(--shadow-md);
    text-align: left;
    /* Default, can be overridden for specific system messages */
    padding: calc(var(--spacing-unit)*2.25) calc(var(--spacing-unit)*2.75);
    border-radius: var(--border-radius-lg);
    display: block;
    /* Ensure it takes full width up to max-width */
}

.dark-theme .message.system-message {
    border-left-color: var(--primary-hover);
}

.message.error-message {
    /* For specific error messages in chat */
    align-self: flex-start;
    /* Or center, depending on desired look */
    background-color: var(--error-bg-light);
    color: var(--error-color);
    border-left: 6px solid var(--error-color);
    display: block;
    /* Or flex if it has an avatar */
    padding: calc(var(--spacing-unit)*1.75) calc(var(--spacing-unit)*2.25);
}

.dark-theme .message.error-message {
    color: hsl(var(--hue-accent-red), 70%, 75%);
    border-left-color: hsl(var(--hue-accent-red), 70%, 75%);
}

.welcome-header {
    display: flex;
    align-items: center;
    margin-bottom: calc(var(--spacing-unit)*2);
}

.robot-icon {
    font-size: 2.2rem;
    color: var(--primary-color);
    margin-right: calc(var(--spacing-unit)*1.75);
}

.welcome-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0;
}

.welcome-subtitle {
    font-size: 1.05rem;
    color: var(--text-secondary);
    margin-bottom: calc(var(--spacing-unit) * 2);
}

.capabilities {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--spacing-unit)*1.25);
    margin: calc(var(--spacing-unit)*2) 0;
}

.capability {
    display: flex;
    align-items: center;
    gap: calc(var(--spacing-unit)*1);
    padding: calc(var(--spacing-unit)*1) calc(var(--spacing-unit)*1.75);
    border-radius: var(--border-radius-pill);
    background-color: hsla(var(--hue-primary), 30%, 95%, 0.8);
    color: var(--text-secondary);
    font-size: 0.85rem;
    transition: var(--transition-default);
    border: 1px solid var(--border-color-soft);
    box-shadow: var(--shadow-xs);
}

.capability:hover {
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    transform: scale(1.04) translateY(-1px);
    box-shadow: var(--shadow-md);
    border-color: transparent;
}

.capability i {
    font-size: 1rem;
}

.quick-actions {
    margin-top: calc(var(--spacing-unit)*2.5);
    border-top: 1px solid var(--border-color-soft);
    padding-top: calc(var(--spacing-unit)*2);
}

.quick-actions p {
    font-size: 1rem;
    margin-bottom: calc(var(--spacing-unit)*1.25);
    font-weight: 500;
}

.quick-actions ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--spacing-unit)*1.25);
}

.quick-action-btn {
    background-color: var(--bg-input);
    color: var(--primary-text-emphasis);
    padding: calc(var(--spacing-unit)*0.85) calc(var(--spacing-unit)*1.25);
    border-radius: var(--border-radius-pill);
    border: 1px solid var(--border-color-medium);
    font-size: 0.875rem;
    text-decoration: none;
    box-shadow: var(--shadow-xs);
    transition: var(--transition-default);
}

.quick-action-btn:hover {
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    border-color: var(--primary-color);
    transform: translateY(-2px) scale(1.02);
    box-shadow: var(--shadow-sm);
}

.file-preview {
    display: none;
    /* Hidden by default */
    border-top: 1px solid var(--border-color-soft);
    box-shadow: var(--shadow-inset);
    max-height: 0;
    /* For transition */
    opacity: 0;
    /* For transition */
    overflow: hidden;
    transition: max-height var(--transition-duration-long) var(--transition-timing-function-smooth), opacity var(--transition-duration-long) var(--transition-timing-function-smooth), padding var(--transition-duration-long) var(--transition-timing-function-smooth);
    position: relative;
    /* For potential absolute positioned elements inside */
}

.file-preview.glass-effect {
    background-color: var(--bg-surface);
}

.file-preview.active {
    display: block;
    /* Show it */
    max-height: 160px;
    /* Animate to this height */
    opacity: 1;
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*2.5);
}

.file-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: calc(var(--spacing-unit)*1.25);
}

.file-preview-header h3 {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: var(--spacing-unit);
}

.file-preview-content {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--spacing-unit)*1.25);
    overflow-y: auto;
    /* Scroll if many files */
    max-height: calc(160px - 52px);
    /* Adjust based on header height and padding */
}

.file-item {
    display: flex;
    align-items: center;
    padding: calc(var(--spacing-unit)*0.85) calc(var(--spacing-unit)*1.25);
    border-radius: var(--border-radius-md);
    background-color: var(--bg-input);
    border: 1px solid var(--border-color-medium);
    font-size: 0.82rem;
    transition: var(--transition-default);
    max-width: 220px;
    /* Prevent very long filenames from breaking layout */
    box-shadow: var(--shadow-xs);
}

.file-item:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
    transform: translateY(-1px) scale(1.01);
}

.file-icon {
    margin-right: calc(var(--spacing-unit)*1);
    color: var(--primary-text-emphasis);
}

.file-name {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-remove {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-left: var(--spacing-unit);
}

.file-remove:hover {
    color: var(--error-color);
    transform: scale(1.12);
}

.message-attachments-summary {
    font-size: 0.875em;
    color: var(--text-secondary);
    margin-top: calc(var(--spacing-unit)*1.25);
    padding: calc(var(--spacing-unit)*1.25);
    border-top: 1px dashed var(--border-color-medium);
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: calc(var(--spacing-unit)*0.75);
}

.message-attachments-summary .fa-paperclip {
    margin-right: calc(var(--spacing-unit)*0.75);
    color: var(--text-muted);
}

.filename-chip {
    background-color: var(--bg-surface-alt);
    color: var(--text-secondary);
    padding: 4px 10px;
    border-radius: var(--border-radius-sm);
    font-size: 0.92em;
    border: 1px solid var(--border-color-soft);
}

.input-area {
    display: flex;
    align-items: flex-end;
    /* Align items to bottom for textarea growth */
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*2);
    border-top: 1px solid var(--border-color-soft);
    box-shadow: 0 -3px 12px hsla(var(--hue-primary), 20%, 50%, 0.05);
    transition: background-color var(--transition-duration-medium), box-shadow var(--transition-duration-short);
    flex-shrink: 0;
    /* Prevent input area from shrinking */
    gap: calc(var(--spacing-unit)*1.25);
    position: relative;
    /* For char counter overlay */
}

.input-area.glass-effect {
    background-color: var(--bg-surface);
}


.input-action-btn {
    width: 44px;
    height: 44px;
    border-radius: var(--border-radius-round);
    font-size: 1.15rem;
    color: var(--text-secondary);
    background-color: var(--bg-input);
    /* Specific bg for buttons */
    border: 1px solid var(--border-color-medium);
    transition: var(--transition-default);
    /* Align with textarea bottom when it's single line */
    margin-bottom: calc((var(--input-area-min-height) - 44px) / 2);
}

.input-action-btn:hover {
    background-color: var(--primary-light-bg);
    color: var(--primary-text-emphasis);
    border-color: hsla(var(--hue-primary), var(--saturation-primary), 80%, 0.7);
    transform: scale(1.08);
    box-shadow: var(--shadow-sm);
}

.input-wrapper {
    flex: 1;
    position: relative;
    /* For char counter */
    display: flex;
    /* To ensure textarea takes full width */
    flex-direction: column;
    /* For potential future elements inside */
}

#user-input {
    width: 100%;
    min-height: var(--input-area-min-height);
    /* Initial height */
    max-height: var(--input-area-max-height);
    /* Max scrollable height */
    padding: var(--textarea-padding-vertical) calc(var(--spacing-unit)*5.5) var(--textarea-padding-vertical) calc(var(--spacing-unit)*1.75);
    /* R L T B - more R for overlay */
    border: 1px solid var(--border-color-medium);
    border-radius: var(--border-radius-lg);
    background-color: var(--bg-input);
    color: var(--text-primary);
    font-size: 1rem;
    resize: none;
    /* No manual resize */
    outline: none;
    line-height: 1.65;
    transition: border-color var(--transition-duration-short) var(--transition-timing-function-smooth),
        background-color var(--transition-duration-medium) var(--transition-timing-function-smooth),
        height var(--transition-duration-short) var(--transition-timing-function-smooth),
        /* Animate height change */
        box-shadow var(--transition-duration-short) var(--transition-timing-function-smooth);
}

#user-input:focus {
    border-color: var(--primary-color);
    background-color: var(--bg-surface);
    /* Slightly different bg on focus */
    box-shadow: 0 0 0 4px hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.2);
}

.input-actions-overlay {
    position: absolute;
    bottom: calc(var(--textarea-padding-vertical) - var(--spacing-unit)*0.35);
    /* Align with text bottom */
    right: calc(var(--spacing-unit)*1.25);
    display: flex;
    align-items: center;
    gap: calc(var(--spacing-unit)*0.75);
}

.overlay-btn {
    font-size: 1.05rem;
    color: var(--text-muted);
    padding: calc(var(--spacing-unit)*0.6);
}

.overlay-btn:hover {
    color: var(--primary-text-emphasis);
}

.char-counter {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-right: calc(var(--spacing-unit)*0.5);
    font-variant-numeric: tabular-nums;
    /* For consistent number width */
}

.char-counter.warn {
    color: var(--warning-color);
}

.char-counter.error {
    color: var(--error-color);
}


.send-button {
    width: 46px;
    height: 46px;
    border-radius: var(--border-radius-round);
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    font-size: 1.25rem;
    box-shadow: var(--shadow-md);
    transition: var(--transition-default);
    align-self: flex-end;
    /* Align with bottom of input area */
    margin-bottom: calc((var(--input-area-min-height) - 46px) / 2);
    /* Center vertically for single line input */
}

.send-button:hover {
    background-color: var(--primary-hover);
    transform: scale(1.1) translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.send-button:active {
    transform: scale(1.02) translateY(0);
    box-shadow: var(--shadow-sm);
}

.send-button .send-icon {
    width: 22px;
    /* Explicit size for SVG/icon */
    height: 22px;
    transition: transform var(--transition-duration-short) var(--transition-timing-function-smooth);
}

.send-button:hover .send-icon {
    transform: translateX(1.5px) translateY(-1.5px) scale(1.05);
}

.send-button .send-loading-icon {
    /* Spinner inside send button */
    font-size: 1.15rem;
}

.typing-indicator {
    /* For the ... typing message */
    font-style: italic;
    font-size: 0.95rem;
}

.dark-theme .typing-indicator .message-bubble {
    background-color: var(--gray-100);
    /* Match agent bubble in dark theme */
}

.typing-indicator .message-text-content {
    display: flex;
    align-items: center;
}

.typing-dots {
    display: inline-flex;
    margin-left: calc(var(--spacing-unit)*1);
}

.typing-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background-color: var(--text-muted);
    margin: 0 2.5px;
    animation: typingDotBounce 1.5s infinite var(--transition-timing-function-smooth);
}

.typing-dot:nth-child(1) {
    animation-delay: 0s;
}

.typing-dot:nth-child(2) {
    animation-delay: 0.25s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.5s;
}

@keyframes typingDotBounce {

    0%,
    80%,
    100% {
        transform: scale(0.75) translateY(1px);
        opacity: 0.5;
    }

    40% {
        transform: scale(1.0) translateY(-1px);
        opacity: 1;
    }
}

.toast-container {
    position: fixed;
    top: calc(var(--header-height) + var(--spacing-unit) * 2);
    right: calc(var(--spacing-unit)*2.5);
    z-index: 10001;
    /* Above everything else */
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit)*1.25);
    width: clamp(300px, 90vw, 400px);
    /* Responsive width */
}

.toast {
    color: var(--text-primary);
    padding: calc(var(--spacing-unit)*1.75) calc(var(--spacing-unit)*2.25);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: flex-start;
    /* Align icon and text properly */
    gap: calc(var(--spacing-unit)*1.75);
    border-left: 6px solid;
    /* Type indicator border */
    position: relative;
}

.toast.glass-effect {
    background-color: var(--bg-surface);
    border: 1px solid var(--border-color-soft);
    /* Re-add border for glass */
}


.toast.info {
    border-left-color: var(--info-color);
    background-color: var(--info-bg-light);
}

.toast.success {
    border-left-color: var(--success-color);
    background-color: var(--success-bg-light);
}

.toast.warning {
    border-left-color: var(--warning-color);
    background-color: var(--warning-bg-light);
}

.toast.error {
    border-left-color: var(--error-color);
    background-color: var(--error-bg-light);
}

.dark-theme .toast.info {
    color: hsl(var(--hue-accent-blue), 70%, 85%);
}

.dark-theme .toast.success {
    color: hsl(var(--hue-accent-green), 60%, 80%);
}

.dark-theme .toast.warning {
    color: hsl(var(--hue-accent-yellow), 80%, 80%);
}

.dark-theme .toast.error {
    color: hsl(var(--hue-accent-red), 70%, 85%);
}

.toast-icon {
    font-size: 1.3rem;
    margin-top: 3px;
    /* Align with text better */
    flex-shrink: 0;
}

.toast.info .toast-icon {
    color: var(--info-color);
}

.toast.success .toast-icon {
    color: var(--success-color);
}

.toast.warning .toast-icon {
    color: var(--warning-color);
}

.toast.error .toast-icon {
    color: var(--error-color);
}

.toast-message {
    flex-grow: 1;
    font-size: 0.95rem;
    line-height: 1.55;
}

.toast-close {
    font-size: 1.05rem;
    color: var(--text-muted);
    margin-left: auto;
    /* Push to the right */
    padding: calc(var(--spacing-unit)*0.6);
    align-self: flex-start;
    /* Align with top of toast text */
}

.toast-close:hover {
    color: var(--text-primary);
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: hsla(var(--hue-primary), 20%, 10%, 0.4);
    /* Semi-transparent overlay */
    display: none;
    /* Hidden by default */
    justify-content: center;
    align-items: center;
    z-index: 5000;
    -webkit-backdrop-filter: blur(8px);
    /* Backdrop blur for overlay */
    backdrop-filter: blur(8px);
    padding: var(--spacing-unit);
    /* Padding for smaller screens */
}

.modal.active {
    /* Class to show modal */
    display: flex;
}

.modal-content {
    padding: calc(var(--spacing-unit)*3.5);
    border-radius: var(--border-radius-xl);
    box-shadow: var(--shadow-xl);
    width: 100%;
    max-width: 620px;
    max-height: 90vh;
    /* Limit height */
    display: flex;
    flex-direction: column;
    position: relative;
    border: 1px solid var(--border-color-soft);
    /* Subtle border */
}

.modal-content.glass-effect {
    background-color: var(--bg-surface);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: calc(var(--spacing-unit)*2.5);
    padding-bottom: calc(var(--spacing-unit)*2);
    border-bottom: 1px solid var(--border-color-soft);
}

.modal-header h2 {
    font-size: 1.45rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: calc(var(--spacing-unit)*1.25);
    color: var(--text-primary);
}

.modal-body {
    margin-bottom: calc(var(--spacing-unit)*3);
    overflow-y: auto;
    /* Scrollable body */
    padding-right: calc(var(--spacing-unit)*1.5);
    /* Space for scrollbar */
    flex-grow: 1;
    /* Allow body to take available space */
}

.setting-group {
    margin-bottom: calc(var(--spacing-unit)*2.5);
}

.setting-group h3 {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: calc(var(--spacing-unit)*1.5);
    color: var(--primary-text-emphasis);
    display: flex;
    align-items: center;
    gap: var(--spacing-unit);
    padding-bottom: calc(var(--spacing-unit)*0.75);
    /* border-bottom: 1px solid var(--border-color-soft); */
    /* Optional separator for group titles */
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: calc(var(--spacing-unit)*1.75);
    padding: calc(var(--spacing-unit)*0.75) 0;
    /* Vertical padding for items */
}

.setting-item label:not(.switch) {
    /* Label text for setting */
    font-size: 0.95rem;
    color: var(--text-secondary);
}

#theme-select,
#font-size,
#animation-level,
.modal-content select {
    /* Styling for select and range inputs */
    padding: calc(var(--spacing-unit)*1) calc(var(--spacing-unit)*1.25);
    border-radius: var(--border-radius-md);
    border: 1px solid var(--border-color-medium);
    background-color: var(--bg-input);
    color: var(--text-primary);
    min-width: 180px;
    /* Ensure decent width */
    font-size: 0.95rem;
    box-shadow: var(--shadow-inset);
}

#font-size {
    /* Range input specific */
    flex-grow: 1;
    /* Take available space */
    margin: 0 calc(var(--spacing-unit)*1.75);
}

#font-size-value {
    /* Display for font size */
    font-size: 0.9rem;
    color: var(--text-secondary);
    min-width: 45px;
    /* Ensure space for "XXpx" */
    text-align: right;
}

/* Switch toggle styling */
.switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 26px;
}

.switch input {
    /* Hide default checkbox */
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border-color-medium);
    transition: var(--transition-duration-medium) var(--transition-timing-function-smooth);
}

.slider:before {
    /* The little knob */
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: var(--transition-duration-medium) var(--transition-timing-function-smooth);
    box-shadow: 0 1px 3px hsla(0, 0%, 0%, 0.25);
}

input:checked+.slider {
    background-color: var(--primary-color);
}

input:focus-visible+.slider {
    /* Focus outline for accessibility */
    box-shadow: 0 0 0 3px hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.3);
}

input:checked+.slider:before {
    transform: translateX(22px);
    /* Move knob to the right */
}

.slider.round {
    border-radius: var(--border-radius-pill);
}

.slider.round:before {
    border-radius: 50%;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: calc(var(--spacing-unit)*1.25);
    padding-top: calc(var(--spacing-unit)*2.5);
    border-top: 1px solid var(--border-color-soft);
}

/* Code Highlighting in Logs & Chat */
.log-think-content pre,
.message-thought-prefix pre.embedded-json {
    background-color: hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.06);
    border: 1px solid hsla(var(--hue-primary), var(--saturation-primary), var(--lightness-primary-normal), 0.15);
    border-radius: var(--border-radius-md);
    padding: calc(var(--spacing-unit)*1.25);
    overflow-x: auto;
    /* Scroll for long lines */
    font-size: 0.875em;
    /* Slightly smaller than surrounding text */
    margin-top: calc(var(--spacing-unit)*1.25);
    line-height: 1.45;
    box-shadow: var(--shadow-xs);
}

.dark-theme .log-think-content pre,
.dark-theme .message-thought-prefix pre.embedded-json {
    background-color: hsla(var(--hue-primary), var(--saturation-primary), 10%, 0.7);
    border-color: hsla(var(--hue-primary), var(--saturation-primary), 25%, 0.7);
}

.log-think-content code.language-json,
.message-thought-prefix pre.embedded-json code {
    color: var(--log-think-text);
    /* Use think text color for code within */
    font-family: 'Roboto Mono', monospace;
    /* Monospace for code */
}

.dark-theme .log-think-content code.language-json,
.dark-theme .message-thought-prefix pre.embedded-json code {
    color: hsl(var(--hue-primary), var(--saturation-primary), 70%);
}

.log-think-content code.language-json.error,
.message-thought-prefix pre.embedded-json.error code {
    /* Style for invalid JSON */
    border: 1px dashed var(--error-color) !important;
    color: var(--error-color) !important;
    background-color: hsla(var(--hue-accent-red), 80%, 50%, 0.05) !important;
}


/* Responsive Adjustments */
@media (max-width: 768px) {
    :root {
        --sidebar-width-expanded: 240px;
        --sidebar-width-collapsed: 68px;
        --header-height: 60px;
        --backdrop-blur-amount: 8px;
    }

    .logo h1 {
        font-size: 1.2rem;
    }

    .chat-header h2 {
        font-size: 1.05rem;
    }

    .header {
        padding: 0 calc(var(--spacing-unit) * 2);
    }

    .sidebar-button i {
        font-size: 1.25rem;
    }

    .sidebar:not(.expanded) .sidebar-button {
        height: 56px;
    }

    .sidebar.expanded .sidebar-button span {
        font-size: 0.85rem;
    }

    .chat-box {
        padding: calc(var(--spacing-unit) * 2);
    }

    .message {
        max-width: 90%;
    }

    .message-avatar {
        width: 36px;
        height: 36px;
        font-size: 1.15rem;
    }

    .message-bubble {
        padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.75);
    }

    .input-area {
        padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.5);
        gap: calc(var(--spacing-unit)*1);
    }

    #user-input {
        padding: var(--textarea-padding-vertical) calc(var(--spacing-unit)*5) var(--textarea-padding-vertical) calc(var(--spacing-unit)*1.5);
        min-height: calc(var(--input-area-min-height) - 6px);
        /* Adjust for smaller overall input area */
        font-size: 0.95rem;
    }

    .input-action-btn,
    .send-button {
        width: 42px;
        height: 42px;
        font-size: 1.1rem;
        margin-bottom: 0;
        /* Align to bottom of flex container */
    }

    .modal-content {
        width: 95%;
        padding: calc(var(--spacing-unit)*2.5);
    }

    .toast-container {
        right: var(--spacing-unit)*1.5;
        top: calc(var(--header-height) + var(--spacing-unit)*1.5);
        width: calc(100% - var(--spacing-unit)*3);
        max-width: 380px;
    }

    .process-log-container {
        padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*2);
        font-size: 0.82rem;
    }
}

@media (max-width: 480px) {
    .capabilities {
        justify-content: center;
    }

    .capability {
        flex-basis: calc(50% - var(--spacing-unit));
        font-size: 0.8rem;
        justify-content: center;
    }

    .header-buttons {
        gap: calc(var(--spacing-unit)*0.5);
    }

    .header-btn {
        width: 38px;
        height: 38px;
        font-size: 1.05rem;
    }

    #current-session-name {
        max-width: 100px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .quick-actions ul {
        justify-content: center;
    }

    .quick-action-btn {
        font-size: 0.82rem;
        padding: calc(var(--spacing-unit)*0.7) calc(var(--spacing-unit)*1);
    }

    .message.system-message {
        padding: calc(var(--spacing-unit)*1.5) calc(var(--spacing-unit)*1.75);
    }

    .welcome-header h2 {
        font-size: 1.25rem;
    }

    .robot-icon {
        font-size: 1.9rem;
    }

    .input-area {
        flex-wrap: nowrap;
        align-items: flex-end;
    }

    .input-wrapper {
        min-width: calc(100% - 42px - 42px - var(--spacing-unit)*2);
        /* Account for two buttons and gaps */
    }
}

/* Animate.css utility for duration control */
.animate__animated {
    --animate-duration: var(--transition-duration-medium);
    /* Default animation duration */
    animation-timing-function: var(--transition-timing-function-smooth) !important;
    /* Ensure smooth timing */
}

/* Animation level controls */
body[data-animation-level="none"] .animate__animated {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
}

body[data-animation-level="basic"] .animate__animated.animate__fadeInUp,
body[data-animation-level="basic"] .animate__animated.animate__fadeInDown,
body[data-animation-level="basic"] .animate__animated.animate__fadeOutUp,
body[data-animation-level="basic"] .animate__animated.animate__fadeOutDown,
body[data-animation-level="basic"] .animate__animated.animate__fadeInRight,
body[data-animation-level="basic"] .animate__animated.animate__fadeOutLeft,
body[data-animation-level="basic"] .animate__animated.animate__bounceIn,
body[data-animation-level="basic"] .animate__animated.animate__bounceOut {
    animation-name: animate__fadeIn !important;
    /* Basic fade in */
    --animate-duration: 0.25s !important;
}

body[data-animation-level="basic"] .animate__animated.animate__fadeOutLeft,
body[data-animation-level="basic"] .animate__animated.animate__fadeOutRight,
body[data-animation-level="basic"] .animate__animated.animate__bounceOut {
    animation-name: animate__fadeOut !important;
    /* Basic fade out */
    --animate-duration: 0.25s !important;
}

/* Specific timing functions for smoother common animations */
.animate__fadeInUp,
.animate__fadeInDown,
.animate__fadeInRight,
.animate__fadeInLeft {
    animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000) !important;
    /* EaseOutCubic */
}

.animate__fadeOutUp,
.animate__fadeOutDown,
.animate__fadeOutRight,
.animate__fadeOutLeft {
    animation-timing-function: cubic-bezier(0.550, 0.055, 0.675, 0.190) !important;
    /* EaseInCubic */
}

/* Final response suggestions (already in previous CSS, but ensure they are present) */
.final-response-suggestions {
    margin-top: calc(var(--spacing-unit) * 1.5);
    padding-top: calc(var(--spacing-unit) * 1.5);
    border-top: 1px dashed var(--border-color-medium);
}

.final-response-suggestions strong {
    display: block;
    font-weight: 600;
    margin-bottom: var(--spacing-unit);
    color: var(--text-secondary);
    font-size: 0.9em;
}

.dark-theme .final-response-suggestions strong {
    color: var(--gray-600);
}

.final-response-suggestions ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 0.75);
}

.final-response-suggestions li a.quick-action-btn {
    display: inline-block;
    width: auto;
    text-align: left;
    background-color: var(--bg-surface-alt);
    border-color: var(--border-color-soft);
    color: var(--primary-text-emphasis);
    font-size: 0.85em;
    padding: calc(var(--spacing-unit)*0.75) calc(var(--spacing-unit)*1.25);
}

.dark-theme .final-response-suggestions li a.quick-action-btn {
    background-color: var(--gray-100);
    border-color: var(--gray-200);
    color: hsl(var(--hue-primary), var(--saturation-primary), 75%)
}

.final-response-suggestions li a.quick-action-btn:hover {
    background-color: var(--primary-color);
    color: var(--text-on-primary-bg);
    border-color: var(--primary-color);
}