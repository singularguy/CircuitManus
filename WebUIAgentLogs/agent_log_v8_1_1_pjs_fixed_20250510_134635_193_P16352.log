2025-05-10 13:46:35,194 - CircuitManusCore - INFO [CircuitManusCore.<module>:78] - Successfully configured file logging. Log messages will also be saved to: D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\WebUIAgentLogs\agent_log_v8_1_1_pjs_fixed_20250510_134635_193_P16352.log
2025-05-10 13:46:35,197 - __mp_main__ - INFO [server.<module>:21] - CircuitAgent 模块导入成功. 
2025-05-10 13:46:35,200 - __mp_main__ - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功. 
2025-05-10 13:46:35,200 - __mp_main__ - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量. 
2025-05-10 13:46:35,275 - asyncio - DEBUG [selector_events.__init__:54] - Using selector: SelectSelector
2025-05-10 13:46:35,453 - server - INFO [server.<module>:21] - CircuitAgent 模块导入成功. 
2025-05-10 13:46:35,454 - server - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功. 
2025-05-10 13:46:35,455 - server - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量. 
2025-05-10 13:46:36,129 - server - INFO [server.websocket_endpoint:117] - WebSocket 连接已接受 (来自: 127.0.0.1:19415).
2025-05-10 13:46:36,145 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 60268210-ae17-47dd-a670-7753e859e6bb
2025-05-10 13:46:36,146 - server - INFO [server.get_agent_instance:67] - 为 Session 60268210-ae17-47dd-a670-7753e859e6bb 创建新的 Agent 实例...
2025-05-10 13:46:36,147 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:36,147 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:36,148 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:36,148 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:36,149 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:36,149 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:36,149 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:36,150 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:36,151 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:36,152 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:36,154 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:36,155 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:36,156 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:36,156 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:36,268 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:36,268 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:36,268 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:36,269 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:36,269 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:36,271 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:36,272 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:36,272 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 60268210-ae17-47dd-a670-7753e859e6bb 创建成功. 
2025-05-10 13:46:36,274 - server - INFO [server.websocket_endpoint:160] - Session 60268210-ae17-47dd-a670-7753e859e6bb WebSocket初始化成功并发送确认. 
2025-05-10 13:46:37,648 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 906a508e-bf9f-4299-bb61-b29ca081556e
2025-05-10 13:46:37,649 - server - INFO [server.get_agent_instance:67] - 为 Session 906a508e-bf9f-4299-bb61-b29ca081556e 创建新的 Agent 实例...
2025-05-10 13:46:37,650 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:37,650 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:37,651 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:37,651 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:37,652 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:37,652 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:37,653 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:37,655 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:37,656 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:37,657 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:37,658 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:37,659 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:37,660 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:37,661 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:37,696 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:37,697 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:37,697 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:37,697 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:37,698 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:37,698 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:37,698 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:37,699 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 906a508e-bf9f-4299-bb61-b29ca081556e 创建成功. 
2025-05-10 13:46:37,700 - server - INFO [server.websocket_endpoint:160] - Session 906a508e-bf9f-4299-bb61-b29ca081556e WebSocket初始化成功并发送确认. 
2025-05-10 13:46:39,905 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 9c262ee6-2f91-456e-9f44-aebe1e950f30
2025-05-10 13:46:39,906 - server - INFO [server.get_agent_instance:67] - 为 Session 9c262ee6-2f91-456e-9f44-aebe1e950f30 创建新的 Agent 实例...
2025-05-10 13:46:39,906 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:39,907 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:39,908 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:39,908 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:39,909 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:39,909 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:39,909 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:39,910 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:39,911 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:39,912 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:39,912 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:39,913 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:39,913 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:39,914 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:39,952 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:39,953 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:39,953 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:39,955 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:39,956 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:39,956 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:39,956 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:39,957 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 9c262ee6-2f91-456e-9f44-aebe1e950f30 创建成功. 
2025-05-10 13:46:39,958 - server - INFO [server.websocket_endpoint:160] - Session 9c262ee6-2f91-456e-9f44-aebe1e950f30 WebSocket初始化成功并发送确认. 
2025-05-10 13:46:41,625 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 25a7d193-1a42-4c01-a0be-1434595ee396
2025-05-10 13:46:41,626 - server - INFO [server.get_agent_instance:67] - 为 Session 25a7d193-1a42-4c01-a0be-1434595ee396 创建新的 Agent 实例...
2025-05-10 13:46:41,626 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:41,627 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:41,627 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:41,628 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:41,628 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:41,629 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:41,629 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:41,630 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:41,632 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:41,633 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:41,634 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:41,634 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:41,635 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:41,636 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:41,674 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:41,675 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:41,676 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:41,676 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:41,676 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:41,677 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:41,677 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:41,678 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 25a7d193-1a42-4c01-a0be-1434595ee396 创建成功. 
2025-05-10 13:46:41,679 - server - INFO [server.websocket_endpoint:160] - Session 25a7d193-1a42-4c01-a0be-1434595ee396 WebSocket初始化成功并发送确认. 
2025-05-10 13:46:43,677 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 44e73ca0-509e-4793-ad13-b1961531ba8a
2025-05-10 13:46:43,678 - server - INFO [server.get_agent_instance:67] - 为 Session 44e73ca0-509e-4793-ad13-b1961531ba8a 创建新的 Agent 实例...
2025-05-10 13:46:43,678 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:43,679 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:43,679 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:43,680 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:43,680 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:43,681 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:43,691 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:43,692 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:43,699 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:43,701 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:43,701 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:43,702 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:43,702 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:43,703 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:43,741 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:43,742 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:43,742 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:43,743 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:43,743 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:43,744 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:43,744 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:43,745 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 44e73ca0-509e-4793-ad13-b1961531ba8a 创建成功. 
2025-05-10 13:46:43,746 - server - INFO [server.websocket_endpoint:160] - Session 44e73ca0-509e-4793-ad13-b1961531ba8a WebSocket初始化成功并发送确认. 
2025-05-10 13:46:45,334 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 4d52d106-24ea-455f-a564-df7f14c2d48d
2025-05-10 13:46:45,334 - server - INFO [server.get_agent_instance:67] - 为 Session 4d52d106-24ea-455f-a564-df7f14c2d48d 创建新的 Agent 实例...
2025-05-10 13:46:45,335 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:45,336 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:45,336 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:45,338 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:45,339 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:45,340 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:45,341 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:45,341 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:45,343 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:45,344 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:45,345 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:45,346 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:45,346 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:45,347 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:45,391 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:45,392 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:45,392 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:45,393 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:45,393 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:45,393 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:45,394 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:45,394 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 4d52d106-24ea-455f-a564-df7f14c2d48d 创建成功. 
2025-05-10 13:46:45,395 - server - INFO [server.websocket_endpoint:160] - Session 4d52d106-24ea-455f-a564-df7f14c2d48d WebSocket初始化成功并发送确认. 
2025-05-10 13:46:47,205 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: session_mahsyplw_1532ja82m
2025-05-10 13:46:47,205 - server - INFO [server.get_agent_instance:67] - 为 Session session_mahsyplw_1532ja82m 创建新的 Agent 实例...
2025-05-10 13:46:47,206 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:46:47,207 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:46:47,207 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:46:47,208 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:46:47,209 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:46:47,209 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:46:47,210 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:46:47,210 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:46:47,212 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:46:47,213 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:46:47,213 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:46:47,214 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:46:47,214 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:46:47,215 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash-250414
2025-05-10 13:46:47,257 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:46:47,258 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:46:47,258 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:46:47,259 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:46:47,259 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:46:47,259 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:46:47,260 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:46:47,260 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session session_mahsyplw_1532ja82m 创建成功. 
2025-05-10 13:46:47,261 - server - INFO [server.websocket_endpoint:160] - Session session_mahsyplw_1532ja82m WebSocket初始化成功并发送确认. 
