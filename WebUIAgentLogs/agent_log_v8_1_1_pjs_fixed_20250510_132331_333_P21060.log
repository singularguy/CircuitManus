2025-05-10 13:23:31,334 - CircuitManusCore - INFO [CircuitManusCore.<module>:78] - Successfully configured file logging. Log messages will also be saved to: D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\WebUIAgentLogs\agent_log_v8_1_1_pjs_fixed_20250510_132331_333_P21060.log
2025-05-10 13:23:31,354 - __mp_main__ - INFO [server.<module>:21] - CircuitAgent 模块导入成功. 
2025-05-10 13:23:31,356 - __mp_main__ - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功. 
2025-05-10 13:23:31,357 - __mp_main__ - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量. 
2025-05-10 13:23:31,479 - asyncio - DEBUG [selector_events.__init__:54] - Using selector: SelectSelector
2025-05-10 13:23:31,635 - server - INFO [server.<module>:21] - CircuitAgent 模块导入成功. 
2025-05-10 13:23:31,636 - server - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功. 
2025-05-10 13:23:31,636 - server - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量. 
2025-05-10 13:23:31,682 - server - INFO [server.websocket_endpoint:117] - WebSocket 连接已接受 (来自: 127.0.0.1:17967).
2025-05-10 13:23:31,699 - server - INFO [server.websocket_endpoint:147] - 收到WebSocket初始化消息,使用提供的session_id: 906a508e-bf9f-4299-bb61-b29ca081556e
2025-05-10 13:23:31,702 - server - INFO [server.get_agent_instance:67] - 为 Session 906a508e-bf9f-4299-bb61-b29ca081556e 创建新的 Agent 实例...
2025-05-10 13:23:31,705 - CircuitManusCore - INFO [CircuitManusCore.__init__:886] - 
============================== CircuitAgent 初始化开始 (V8.1.1-PJS Core, Perfected JSON, Prompt Fix) ==============================
2025-05-10 13:23:31,707 - CircuitManusCore - INFO [CircuitManusCore.__init__:895] - [AgentV8_1_1_WS Init] 控制台日志级别已设置为: DEBUG (Verbose Mode: True)
2025-05-10 13:23:31,708 - CircuitManusCore - INFO [CircuitManusCore.__init__:900] - [AgentV8_1_1_WS Init] 正在动态发现并注册工具...
2025-05-10 13:23:31,708 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'add_component_tool'
2025-05-10 13:23:31,710 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-10 13:23:31,711 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-10 13:23:31,715 - CircuitManusCore - INFO [CircuitManusCore.__init__:906] - [AgentV8_1_1_WS Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-10 13:23:31,715 - CircuitManusCore - INFO [CircuitManusCore.__init__:912] - [AgentV8_1_1_WS Init] 共发现并注册了 4 个工具. 
2025-05-10 13:23:31,718 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:914] - [AgentV8_1_1_WS Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等). 如果用户未指定 ID,会自动生成. ",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID. "
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来. ",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID. "
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID. "
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述. ",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-10 13:23:31,721 - CircuitManusCore - INFO [CircuitManusCore.__init__:255] - [MemoryManager] 初始化记忆模块...
2025-05-10 13:23:31,722 - CircuitManusCore - INFO [CircuitManusCore.__init__:109] - [Circuit] 初始化电路实体. 
2025-05-10 13:23:31,725 - CircuitManusCore - INFO [CircuitManusCore.__init__:116] - [Circuit] 电路实体初始化完成. 
2025-05-10 13:23:31,730 - CircuitManusCore - INFO [CircuitManusCore.__init__:267] - [MemoryManager] 记忆模块初始化完成. 短期上限: 30 条, 长期上限: 75 条. 
2025-05-10 13:23:31,733 - CircuitManusCore - INFO [CircuitManusCore.__init__:326] - [LLMInterface] 初始化 LLM 接口,目标模型: glm-4-flash
2025-05-10 13:23:31,855 - CircuitManusCore - INFO [CircuitManusCore.__init__:334] - [LLMInterface] 智谱 AI 客户端初始化成功. 
2025-05-10 13:23:31,856 - CircuitManusCore - INFO [CircuitManusCore.__init__:343] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash, Temp: 0.01, MaxTokens: 8190). 
2025-05-10 13:23:31,857 - CircuitManusCore - INFO [CircuitManusCore.__init__:427] - [OutputParserV8_1] 初始化输出解析器 (适配 ManusLLMResponse-V8.1-Perfected JSON结构). 
2025-05-10 13:23:31,857 - CircuitManusCore - INFO [CircuitManusCore.__init__:676] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止, UI回调增强 V8.1.1). 
2025-05-10 13:23:31,858 - CircuitManusCore - INFO [CircuitManusCore.__init__:687] - [ToolExecutor] 工具执行配置: 每个工具最多重试 3 次,重试间隔 1.0 秒. Verbose Mode: True
2025-05-10 13:23:31,858 - CircuitManusCore - INFO [CircuitManusCore.__init__:933] - [AgentV8_1_1_WS Init] 规划LLM重试次数: 5, 工具执行重试次数: 3, 最大重规划尝试次数: 3
2025-05-10 13:23:31,859 - CircuitManusCore - INFO [CircuitManusCore.__init__:935] - 
============================== CircuitAgent 初始化成功 ==============================

2025-05-10 13:23:31,859 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 906a508e-bf9f-4299-bb61-b29ca081556e 创建成功. 
2025-05-10 13:23:31,861 - server - INFO [server.websocket_endpoint:160] - Session 906a508e-bf9f-4299-bb61-b29ca081556e WebSocket初始化成功并发送确认. 
